var registerForm=document.querySelector(".form--register"),loginForm=document.querySelector(".form--login"),createNoteForm=document.querySelector(".form--createnote"),modal=document.querySelector(".modal--delete"),inputs=Array.from(document.querySelectorAll("input")),textarea=document.querySelector("textarea"),logoutButton=document.querySelector(".btn--logout"),updateNoteForm=document.querySelector(".form--updateNote"),deleteNoteForm=document.querySelector(".form--deleteNote");function processRegister(e){e.preventDefault();var t="";if(validateEmail(registerForm.email)||(error(registerForm.email),t+="Email address is invalid."),validatePassword(registerForm.password)||(error(registerForm.password),t+=t?"<br /> Password is invalid":"Password is invalid"),t)return displayError(t);var o={email:registerForm.email.value,password:registerForm.password.value};fetch("/register",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(function(e){if(!e.ok)return submitError(e);window.location="/login"}).catch(submitError)}function processLogin(e){e.preventDefault();var t="";if(loginForm.email.value||(error(loginForm.email),t+="Missing email!"),loginForm.password.value||(error(loginForm.password),t+=t?"<br /> Missing password!":"Missing password!"),t)return displayError(t);var o={email:loginForm.email.value,password:loginForm.password.value};fetch("/login",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(function(e){return e.ok?e.json().then(function(e){localStorage.token=e.token,window.location="/notes?token="+e.token}):submitError(e)}).catch(submitError)}function processLogout(){fetch("/logout",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT"}).then(function(e){return e.ok?e.text().then(function(e){localStorage.token="",window.location="/"}):submitError(e)}).catch(submitError)}function processNewNote(e){e.preventDefault();var t="";if(createNoteForm.name.value||(error(createNoteForm.name),t+="Missing Title"),createNoteForm.text.value||(t?(error(createNoteForm.text),t+="<br /> Missing Note"):(error(createNoteForm.text),t+="Missing Note")),t)return displayError(t);var o={name:createNoteForm.name.value,text:createNoteForm.text.value};fetch("/notes",{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"POST",body:JSON.stringify(o)}).then(function(e){if(!e.ok)return submitError(e);window.location="/notes?token="+localStorage.token}).catch(submitError)}function processNoteUpdate(e){e.preventDefault();var t="";if(updateNoteForm.name.value||(error(updateNoteForm.name),t+="Missing Title"),updateNoteForm.text.value||(error(updateNoteForm.text),t+=t?"<br /> Missing Note":"Missing Note"),t)return displayError(t);var o={name:updateNoteForm.name.value,text:updateNoteForm.text.value},r=window.location.pathname,n=r.substring(r.lastIndexOf("/")+1);fetch("/notes/"+n,{headers:{"Content-Type":"application/json","x-access-token":localStorage.token},method:"PUT",body:JSON.stringify(o)}).then(function(e){if(!e.ok)return submitError(e);window.location="/notes?token="+localStorage.token}).catch(submitError)}function processDeleteNote(e){e.preventDefault();var t=window.location.pathname,o=t.substring(t.lastIndexOf("/")+1);fetch("/notes/"+o,{headers:{"x-access-token":localStorage.token},method:"DELETE"}).then(function(e){if(!e.ok)return submitError(e);window.location="/notes?token="+localStorage.token}).catch(submitError)}function validateEmail(e){var t=e.value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)}function validatePassword(e){return""!==e.value}function error(e){e.style.border="3px solid #f00"}function clearError(e){e.style.border=""}function displayError(e){var t=document.querySelector(".error-message");t.innerHTML=e,t.style.visibility="visible"}function submitError(e,t){return 400<=e.status&&e.status<500?e.text().then(function(e){displayError(e)}):displayError(t||"There was a problem submitting your form. Please try again later.")}modal&&modal.addEventListener("click",function(e){e.stopPropagation(),e.target===modal&&(modal.style.display="none")}),textarea&&textarea.addEventListener("focus",function(){clearError(this)}),inputs&&inputs.forEach(function(e){e.addEventListener("focus",function(){clearError(this)})}),logoutButton&&logoutButton.addEventListener("click",processLogout),registerForm&&registerForm.addEventListener("submit",processRegister),loginForm&&loginForm.addEventListener("submit",processLogin),createNoteForm&&createNoteForm.addEventListener("submit",processNewNote),updateNoteForm&&updateNoteForm.addEventListener("submit",processNoteUpdate),deleteNoteForm&&deleteNoteForm.addEventListener("submit",processDeleteNote);